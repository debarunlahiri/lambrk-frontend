<div class="subreddit-container">
  <!-- Loading State -->
  <div *ngIf="loading() && !subreddit()" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading subreddit...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !subreddit()" class="error-container">
    <mat-icon>error_outline</mat-icon>
    <h2>{{ error() }}</h2>
    <p>The subreddit r/{{ subredditName() }} could not be found.</p>
    <button mat-raised-button color="primary" routerLink="/">
      <mat-icon>home</mat-icon>
      Go Home
    </button>
  </div>

  <!-- Subreddit Content -->
  <div *ngIf="subreddit()" class="subreddit-content">
    <!-- Header -->
    <div class="subreddit-header" [style.background-image]="subreddit()!.headerImageUrl ? 'url(' + subreddit()!.headerImageUrl + ')' : 'none'">
      <div class="header-overlay">
        <div class="header-content">
          <div class="subreddit-icon">
            <img *ngIf="subreddit()!.iconImageUrl" [src]="subreddit()!.iconImageUrl" [alt]="subreddit()!.name" />
            <mat-icon *ngIf="!subreddit()!.iconImageUrl">forum</mat-icon>
          </div>
          <div class="subreddit-info">
            <h1>r/{{ subreddit()!.name }}</h1>
            <p class="subreddit-title">{{ subreddit()!.title }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stats">
        <div class="stat">
          <mat-icon>people</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ subreddit()!.memberCount | formatNumber }}</span>
            <span class="stat-label">Members</span>
          </div>
        </div>
        <div class="stat">
          <mat-icon>visibility</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ subreddit()!.activeUserCount | formatNumber }}</span>
            <span class="stat-label">Online</span>
          </div>
        </div>
        <div class="stat">
          <mat-icon>calendar_today</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ subreddit()!.createdAt | timeAgo }}</span>
            <span class="stat-label">Created</span>
          </div>
        </div>
      </div>
      <div class="actions">
        <button
          mat-raised-button
          [color]="subreddit()!.isUserSubscribed ? 'accent' : 'primary'"
          (click)="toggleSubscription()"
        >
          <mat-icon>{{ subreddit()!.isUserSubscribed ? 'check' : 'add' }}</mat-icon>
          {{ subreddit()!.isUserSubscribed ? 'Joined' : 'Join' }}
        </button>
        <button mat-raised-button color="primary" (click)="createPost()">
          <mat-icon>add</mat-icon>
          Create Post
        </button>
        <button mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item *ngIf="subreddit()!.isUserModerator">
            <mat-icon>settings</mat-icon>
            <span>Subreddit Settings</span>
          </button>
          <button mat-menu-item>
            <mat-icon>share</mat-icon>
            <span>Share</span>
          </button>
          <button mat-menu-item>
            <mat-icon>flag</mat-icon>
            <span>Report</span>
          </button>
        </mat-menu>
      </div>
    </div>

    <!-- Badges -->
    <div class="badges" *ngIf="subreddit()!.isOver18 || subreddit()!.isRestricted || !subreddit()!.isPublic">
      <mat-chip *ngIf="subreddit()!.isOver18" class="nsfw-chip">
        <mat-icon>warning</mat-icon>
        NSFW
      </mat-chip>
      <mat-chip *ngIf="subreddit()!.isRestricted" class="restricted-chip">
        <mat-icon>lock</mat-icon>
        Restricted
      </mat-chip>
      <mat-chip *ngIf="!subreddit()!.isPublic" class="private-chip">
        <mat-icon>visibility_off</mat-icon>
        Private
      </mat-chip>
      <mat-chip *ngIf="subreddit()!.isUserModerator" class="moderator-chip">
        <mat-icon>shield</mat-icon>
        Moderator
      </mat-chip>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Posts Section -->
      <div class="posts-section">
        <!-- Sort Options -->
        <div class="sort-bar">
          <button
            mat-button
            [class.active]="sortBy() === 'hot'"
            (click)="onSortChange('hot')"
          >
            <mat-icon>local_fire_department</mat-icon>
            Hot
          </button>
          <button
            mat-button
            [class.active]="sortBy() === 'new'"
            (click)="onSortChange('new')"
          >
            <mat-icon>fiber_new</mat-icon>
            New
          </button>
          <button
            mat-button
            [class.active]="sortBy() === 'top'"
            (click)="onSortChange('top')"
          >
            <mat-icon>trending_up</mat-icon>
            Top
          </button>
        </div>

        <!-- Posts List -->
        <div class="posts-list">
          <mat-card
            *ngFor="let post of posts()"
            class="post-card"
            (click)="navigateToPost(post.id)"
          >
            <div class="post-header">
              <span class="author">u/{{ post.author.username }}</span>
              <span class="separator">â€¢</span>
              <span class="time">{{ post.createdAt | timeAgo }}</span>
              <mat-chip *ngIf="post.flairText" class="flair-chip">
                {{ post.flairText }}
              </mat-chip>
            </div>

            <h3 class="post-title">{{ post.title }}</h3>
            <p class="post-content" *ngIf="post.content">{{ post.content }}</p>

            <div class="post-footer">
              <span class="stat">
                <mat-icon>arrow_upward</mat-icon>
                {{ post.score | formatNumber }}
              </span>
              <span class="stat">
                <mat-icon>comment</mat-icon>
                {{ post.commentCount | formatNumber }}
              </span>
              <span class="stat" *ngIf="post.awardCount > 0">
                <mat-icon>emoji_events</mat-icon>
                {{ post.awardCount }}
              </span>
            </div>
          </mat-card>

          <!-- Empty State -->
          <div *ngIf="posts().length === 0" class="empty-state">
            <mat-icon>inbox</mat-icon>
            <h3>No posts yet</h3>
            <p>Be the first to post in r/{{ subreddit()!.name }}!</p>
            <button mat-raised-button color="primary" (click)="createPost()">
              <mat-icon>add</mat-icon>
              Create Post
            </button>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- About Card -->
        <mat-card class="about-card">
          <h3>About Community</h3>
          <p *ngIf="subreddit()!.description">{{ subreddit()!.description }}</p>
          <p *ngIf="!subreddit()!.description" class="no-description">
            No description available.
          </p>

          <div class="sidebar-stats">
            <div class="sidebar-stat">
              <mat-icon>people</mat-icon>
              <div>
                <strong>{{ subreddit()!.memberCount | formatNumber }}</strong>
                <span>Members</span>
              </div>
            </div>
            <div class="sidebar-stat">
              <mat-icon>visibility</mat-icon>
              <div>
                <strong>{{ subreddit()!.activeUserCount | formatNumber }}</strong>
                <span>Online</span>
              </div>
            </div>
            <div class="sidebar-stat">
              <mat-icon>calendar_today</mat-icon>
              <div>
                <strong>{{ subreddit()!.createdAt | timeAgo }}</strong>
                <span>Created</span>
              </div>
            </div>
          </div>

          <button
            mat-raised-button
            color="primary"
            (click)="createPost()"
            class="create-post-btn"
          >
            <mat-icon>add</mat-icon>
            Create Post
          </button>
        </mat-card>

        <!-- Rules Card -->
        <mat-card class="rules-card" *ngIf="subreddit()!.sidebarText">
          <h3>Rules</h3>
          <div class="rules-content">
            {{ subreddit()!.sidebarText }}
          </div>
        </mat-card>

        <!-- Moderators Card -->
        <mat-card class="moderators-card">
          <h3>Moderators</h3>
          <div class="moderator-item">
            <mat-icon>account_circle</mat-icon>
            <span>u/{{ subreddit()!.createdBy.username }}</span>
            <mat-chip class="creator-chip">Creator</mat-chip>
          </div>
        </mat-card>
      </div>
    </div>
  </div>
</div>
