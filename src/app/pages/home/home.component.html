<div class="home-container">
  <!-- Main Feed -->
  <main class="main-feed">
    <!-- Create Post Card -->
    <mat-card class="create-post-card" (click)="onCreatePost()">
      <div class="create-post-content">
        <mat-icon class="avatar-placeholder">account_circle</mat-icon>
        <div class="create-input">
          <input type="text" readonly placeholder="Create Post" />
        </div>
        <button mat-icon-button><mat-icon>image</mat-icon></button>
        <button mat-icon-button><mat-icon>link</mat-icon></button>
      </div>
    </mat-card>

    <!-- Sort Bar -->
    <div class="sort-filter-bar">
      <div class="sort-options">
        <button mat-button [class.active]="selectedSort() === 'hot'" (click)="onSortChange('hot')">Hot</button>
        <button mat-button [class.active]="selectedSort() === 'new'" (click)="onSortChange('new')">New</button>
        <button mat-button [class.active]="selectedSort() === 'top'" (click)="onSortChange('top')">Top</button>
      </div>
      <button mat-icon-button (click)="refreshFeed()"><mat-icon>refresh</mat-icon></button>
    </div>

    <!-- Search -->
    <mat-card class="search-card">
      <mat-form-field appearance="outline" class="search-field">
        <mat-icon matPrefix>search</mat-icon>
        <input matInput [formControl]="searchControl" placeholder="Search posts" autocomplete="off" />
        @if (searchControl.value) {
          <button mat-icon-button matSuffix type="button" (click)="onClearSearch()">
            <mat-icon>clear</mat-icon>
          </button>
        }
      </mat-form-field>
    </mat-card>

    <!-- Loading -->
    @if (postService.loading()) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading posts...</p>
      </div>
    }

    <!-- Error -->
    @if (postService.error(); as err) {
      <mat-card class="error-card">
        <mat-icon>error_outline</mat-icon>
        <p>{{ err }}</p>
        <button mat-raised-button color="primary" (click)="refreshFeed()">Retry</button>
      </mat-card>
    }

    <!-- Posts -->
    @for (post of postService.posts(); track post.id) {
      <mat-card class="post-card">
        <div class="post-content">
          <!-- Voting -->
          <div class="voting-section">
            <button mat-icon-button class="vote-btn upvote" (click)="onVote(post, 'upvote')">
              <mat-icon>arrow_upward</mat-icon>
            </button>
            <span class="vote-count">{{ post.score | formatNumber }}</span>
            <button mat-icon-button class="vote-btn downvote" (click)="onVote(post, 'downvote')">
              <mat-icon>arrow_downward</mat-icon>
            </button>
          </div>

          <!-- Body -->
          <div class="post-body">
            <div class="post-header">
              <a class="subreddit-link" [routerLink]="'/r/' + post.subreddit.name">r/{{ post.subreddit.name }}</a>
              <span class="post-meta">
                Posted by
                <a class="author-link" [routerLink]="'/user/' + post.author.username">u/{{ post.author.username }}</a>
                {{ post.createdAt | timeAgo }}
              </span>
              @if (post.flairText) {
                <span class="post-flair">{{ post.flairText }}</span>
              }
              @if (post.isOver18) {
                <span class="post-flair nsfw">NSFW</span>
              }
              @if (post.isSpoiler) {
                <span class="post-flair spoiler">Spoiler</span>
              }
            </div>

            <h3 class="post-title">
              <a [routerLink]="'/posts/' + post.id">{{ post.title }}</a>
            </h3>

            @if (post.content) {
              <p class="post-content-preview">{{ post.content }}</p>
            }

            @if (post.awardCount > 0) {
              <div class="post-awards">
                <span class="award-badge">
                  <mat-icon>emoji_events</mat-icon>
                  {{ post.awardCount }} {{ post.awardCount === 1 ? 'Award' : 'Awards' }}
                </span>
              </div>
            }

            <div class="post-actions">
              <a class="action-btn" [routerLink]="'/posts/' + post.id">
                <mat-icon>chat_bubble_outline</mat-icon>
                <span>{{ post.commentCount }} Comments</span>
              </a>
              <button class="action-btn">
                <mat-icon>share</mat-icon>
                <span>Share</span>
              </button>
              <button class="action-btn">
                <mat-icon>bookmark_border</mat-icon>
                <span>Save</span>
              </button>
            </div>
          </div>
        </div>
      </mat-card>
    }

    <!-- Empty -->
    @if (!postService.loading() && !postService.error() && postService.posts().length === 0) {
      <mat-card class="empty-state">
        <div class="empty-content">
          <mat-icon class="empty-icon">inbox</mat-icon>
          <h3>No posts yet</h3>
          <p>Be the first to create a post</p>
          <button mat-raised-button color="primary" (click)="onCreatePost()">Create Post</button>
        </div>
      </mat-card>
    }

    <!-- Load More -->
    @if (postService.posts().length >= 20) {
      <div class="load-more">
        <button mat-stroked-button (click)="loadMore()" [disabled]="postService.loading()">
          Load More
        </button>
      </div>
    }
  </main>

  <!-- Sidebar -->
  <aside class="sidebar">
    <mat-card class="sidebar-card">
      <div class="card-header"><h3>Home</h3></div>
      <div class="card-content">
        <p class="community-description">
          Your personal Lambrk front page. Come here to check in with your favourite communities.
        </p>
        <mat-divider></mat-divider>
        <button mat-raised-button color="primary" class="full-width sidebar-btn" (click)="onCreatePost()">
          Create Post
        </button>
      </div>
    </mat-card>
  </aside>
</div>
