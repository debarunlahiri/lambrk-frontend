<!-- Navbar -->
<mat-toolbar color="primary" class="navbar">
  <!-- Logo / Home link -->
  <a routerLink="/" class="brand">
    <mat-icon>chat</mat-icon>
    <span class="brand-text">lambrk</span>
  </a>

  <span class="spacer"></span>

  <!-- Theme Toggle -->
  <button
    mat-icon-button
    (click)="themeService.toggleTheme()"
    [matTooltip]="themeService.currentTheme() === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode'"
    aria-label="Toggle theme"
    class="theme-toggle"
  >
    @if (themeService.currentTheme() === 'dark') {
      <mat-icon>light_mode</mat-icon>
    } @else {
      <mat-icon>dark_mode</mat-icon>
    }
  </button>

  <!-- Right-side actions -->
  @if (authService.isAuthenticated()) {
    <!-- Authenticated user menu -->
    <button mat-icon-button routerLink="/search" aria-label="Search">
      <mat-icon>search</mat-icon>
    </button>

    <button mat-icon-button routerLink="/create-post" aria-label="Create post">
      <mat-icon>add_circle</mat-icon>
    </button>

    <button mat-icon-button routerLink="/notifications" aria-label="Notifications">
      <mat-icon>notifications_none</mat-icon>
    </button>

    <button mat-icon-button [matMenuTriggerFor]="userMenu" aria-label="User menu">
      <mat-icon>account_circle</mat-icon>
    </button>

    <mat-menu #userMenu="matMenu" xPosition="before">
      <div class="user-menu-header">
        <mat-icon>account_circle</mat-icon>
        <div>
          <strong>{{ authService.displayName() }}</strong>
          <div class="karma-text">{{ authService.userKarma() }} karma</div>
        </div>
      </div>
      <mat-divider></mat-divider>
      <button mat-menu-item routerLink="/user/{{ authService.currentUser()?.username }}">
        <mat-icon>person</mat-icon>
        <span>Profile</span>
      </button>
      <button mat-menu-item routerLink="/settings">
        <mat-icon>settings</mat-icon>
        <span>Settings</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="onLogout()">
        <mat-icon>logout</mat-icon>
        <span>Log Out</span>
      </button>
    </mat-menu>
  } @else {
    <!-- Guest actions -->
    <a mat-stroked-button routerLink="/auth/login" class="nav-btn">Log In</a>
    <a mat-raised-button color="accent" routerLink="/auth/register" class="nav-btn">Sign Up</a>
  }
</mat-toolbar>

<!-- Page content -->
<main class="app-main">
  <router-outlet />
</main>

<!-- Error notifications -->
<app-error-notifications />
